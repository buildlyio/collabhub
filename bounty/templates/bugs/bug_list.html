{% extends 'base.html' %}
{% block content %}
  <div class="bug-list">
    <h2>Bug List</h2>
    <div class="table-responsive">
      <table class="table table-striped table-bordered" id="bugTable">
        <thead>
          <tr>
            <th>App Name</th>
            <th>Version</th>
            <th>Title</th>
            <th>Severity</th>
            <th>Submitted by</th>
            <th>Description</th>
            <th>Expected Behaviour</th>
            <th>Steps to Reproduce</th>
            <th>Screenshots</th>
            <th>Action</th>
            <th>Assign to Bounty</th>
          </tr>
        </thead>
        <tbody>
          {% for bug in bugs %}
            <tr>
              <td>{{ bug.app_name }}</td>
              <td>{{ bug.version }}</td>
              <td>{{ bug.title }}</td>
              <td>{{ bug.get_severity_display }}</td>
              <td>{{ bug.name }} ({{ bug.email }})</td>
              <td>{{ bug.description }}</td>
              <td>{{ bug.expected_behaviour }}</td>
              <td>{{ bug.steps_to_reproduce }}</td>
              <td>
                {% if bug.screenshots %}
                  <a href="{{ bug.screenshots.url }}" target="_blank">
                    <img src="{{ bug.screenshots.url }}" alt="Screenshot" class="img-thumbnail" style="max-height: 50px; max-width: 50px;">
                  </a>
                {% endif %}
              </td>
              <td>
                {% if user.is_staff %}
                  <form action="{% url 'bug_accept' bug.id %}" method="post">
                    {% csrf_token %}
                    <input type="submit" value="Accept Bug">
                  </form>
                  <form action="{% url 'bug_send_to_github' bug.id %}" method="post">
                    {% csrf_token %}
                    <input type="submit" value="Send to GitHub">
                  </form>
                {% endif %}
              </td>
              <td>
                {% if user.is_staff %}
                  <select id="assignToBounty" name="assign_to_bounty" class="form-select" disabled>
                    <!-- Populate options dynamically from open bounties -->
                    {% for bounty in bounties %}
                      <option value="{{ bounty.id }}">{{ bounty.title }}</option>
                    {% endfor %}
                  </select>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      $('#bugTable').DataTable();
    });
  </script>
{% endblock %}
